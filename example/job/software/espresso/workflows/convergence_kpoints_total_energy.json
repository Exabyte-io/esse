{
    "name": "K point convergence",
    "app": "espresso",
    "units": [
        {
            "type": "assignment",
            "flowchartId": "init_tolerance",
            "next": "init_energy",
            "head": true,
            "assignment": {
                "name": "tolerance",
                "value": "0"
            }
        },
        {
            "type": "assignment",
            "flowchartId": "init_energy",
            "next": "init_N_K",
            "assignment": {
                "name": "previous_total_E",
                "value": "0"
            }
        },
        {
            "type": "assignment",
            "flowchartId": "init_N_K",
            "next": "run_scf_calculation",
            "assignment": {
                "name": "N_K",
                "value": "1"
            }
        },
        {
            "flowchartId": "run_scf_calculation",
            "type": "compute",
            "next": "check_for_convergence",
            "app": {
                "flavor": "pw_scf",
                "version": "5.1.1",
                "name": "espresso",
                "exec": "pw.x",
                "summary": "Quantum Espresso"
            },
            "results": [
                {
                    "name": "total_energy"
                }
            ],
            "monitors": [
                {
                    "name": "scf_accuracy"
                },
                {
                    "name": "standard_output"
                }
            ],
            "input": [
                {
                    "content": "include_text(pw_scf.in)",
                    "name": "pw_scf.in"
                }
            ]
        },
        {
            "flowchartId": "check_for_convergence",
            "type": "condition",
            "condition": {
                "input": [
                    {
                        "scope": "global",
                        "name": "previous_total_E"
                    },
                    {
                        "scope": "run_scf_calculation",
                        "name": "total_energy"
                    }
                ],
                "statement": "abs(previous_total_E-total_energy) < tolerance",
                "then": "convergence_is_reached",
                "else": "save_previous_value",
                "maxOccurences": 100
            }
        },
        {
            "flowchartId": "save_previous_value",
            "type": "assignment",
            "next": "increase_N_K_by_1",
            "assignment": {
                "input": [
                    {
                        "scope": "run_scf_calculation",
                        "name": "total_energy"
                    }
                ],
                "name": "previous_total_E",
                "value": "total_energy"
            }
        },
        {
            "flowchartId": "increase_N_K_by_1",
            "type": "assignment",
            "next": "run_scf_calculation",
            "assignment": {
                "input": [
                    {
                        "scope": "global",
                        "name": "N_K"
                    }
                ],
                "name": "N_K",
                "value": "N_K+1"
            }
        },
        {
            "flowchartId": "convergence_is_reached",
            "type": "assignment",
            "next": "exit",
            "assignment": {
                "input": [
                    {
                        "scope": "global",
                        "name": "N_K"
                    }
                ],
                "name": "N_K",
                "value": "N_K-1"
            }
        },
        {
            "flowchartId": "exit",
            "type": "exit",
            "exit": {
                "throwException": false
            }
        }
    ]
}
